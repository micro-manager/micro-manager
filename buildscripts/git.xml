<project name="mm-gitdeps.jgit-ant.project" default="clone-reps" xmlns:git="org.eclipse.jgit.ant">
    <include file="../buildscripts/buildprops.xml"/>


    <taskdef resource="org/eclipse/jgit/ant/ant-tasks.properties">
        <classpath>
            <pathelement location="../dependencies/artifacts/build/org.eclipse.jgit-4.11.9.201909030838-r.jar"/>
            <pathelement location="../dependencies/artifacts/build/org.eclipse.jgit.ant-4.11.9.201909030838-r.jar"/>
            <pathelement location="../dependencies/artifacts/build/jsch-0.1.55.jar"/>
            <pathelement location="../dependencies/artifacts/build/slf4j-api-2.0.0-alpha6.jar"/>
        </classpath>
    </taskdef>

    <macrodef name="mm-git">
        <attribute name="git-url"/>
        <attribute name="git-branch"/>
        <attribute name="rep-folder"/>
        <sequential>
            <local name="git.dep"/>
            <echo message="GitHub url @{git-url}"/>
            <property name="git.dep" value="${mm.basedir}/dependencies/git/@{rep-folder}"/>
            <if>
                <resourceexists>
                    <file file="${git.dep}"/>
                </resourceexists>
                <then>
                    <echo message="Clone skipped because folder ${git.dep} already exists."/>
                </then>
                <else>
                    <git-clone uri="@{git-url}" dest="${git.dep}" branch="@{git-branch}"/>
                </else>
            </if>
        </sequential>
    </macrodef>

    <target name="clone-reps" depends="mm-git-init-dir,clone-iconloader"/>

    <target name="mm-git-init-dir">
        <mkdir dir="dependencies/git"/>
    </target>

    <target name="clone-iconloader">
        <echo message="Downloading IconlLoader from GitHub."/>
        <mm-git git-url="https://github.com/bulenkov/iconloader.git" git-branch="master" rep-folder="iconloader"/>
        <git-checkout src="${mm.basedir}/dependencies/git/iconloader" branch="ae7d9e197d496e3768f22a9ab5803d0f09e510db" />
        <copy file="${mm.basedir}/dependencies/git/iconloader/iconloader.jar"
              tofile="${mm.basedir}/dependencies/artifacts/compile/iconloader.jar"/>
    </target>

</project>
