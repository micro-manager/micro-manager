<project name="mm.version">
	<!-- In plain builds (not invoked from the nightly script),
		mm.versionstring is not expected to be set. In that case, do not set
		any version. -->

	<target name="set-version" if="mm.versionstring">
		<property name="mm.installer.basename" value="MMSetup_${mm.architecture.bits}bit_${mm.versionstring}"/>
		<property name="mm.symbols.basename" value="MMDebugSymbols_DoNotDistribute_${mm.architecture.bits}bit_${mm.versionstring}"/>

		<tempfile property="mm.version.java.tmp" suffix=".java"/>
		<copy tofile="${mm.version.java.tmp}" file="${mm.basedir}/buildscripts/MMVersion.java.in"/>
		<replace file="${mm.version.java.tmp}"
			token="@VERSION_STRING@" value="${mm.versionstring}"
			failOnNoReplacements="true"/>
        <move tofile="${mm.basedir}/mmstudio/src/main/java/org/micromanager/internal/MMVersion.java" file="${mm.version.java.tmp}"/>

		<echo>Version set to: "${mm.versionstring}"</echo>
	</target>
</project>
